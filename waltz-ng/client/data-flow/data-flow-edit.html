<!--
  ~  Waltz
  ~ Copyright (c) David Watkins. All rights reserved.
  ~ The use and distribution terms for this software are covered by the
  ~ Eclipse Public License 1.0 (http://opensource.org/licenses/eclipse-1.0.php)
  ~ which can be found in the file epl-v10.html at the root of this distribution.
  ~ By using this software in any fashion, you are agreeing to be bound by
  ~ the terms of this license.
  ~ You must not remove this notice, or any other, from this software.
  ~
  -->
<div>
    <waltz-page-header name="Register Logical Data Flows"
                       small="{{ ctrl.app.name }}">
        <ol class="waltz-breadcrumbs">
            <li><a ui-sref="main">Home</a></li>
            <li>
                <a ui-sref="main.app.view ({id: ctrl.app.id})">
                    {{ ctrl.app.name }}
                </a>
            </li>
            <li>Register Logical Data Flows</li>
        </ol>
    </waltz-page-header>

    <h1>{{ctrl.model.data.source}}</h1>
    <waltz-section name="Details">
        <form name="dataFlowForm" novalidate ng-submit="ctrl.submit()">

            <!-- SLOPE DIAGRAM -->
            <div class="row">
                <div class="col-md-11">
                    <waltz-app-data-flow-diagram incoming="ctrl.data.incoming"
                                                 outgoing="ctrl.data.outgoing"
                                                 sources="ctrl.data.sources"
                                                 targets="ctrl.data.targets"
                                                 tweakers="ctrl.tweakers"
                                                 types="ctrl.data.flowTypes"></waltz-app-data-flow-diagram>
                </div>
            </div>

            <hr/>

            <!-- ADD UP/DOWN STREAMS -->
            <div class="row" ng-hide="ctrl.model.selectedApp != null">
                <!-- ADD UPSTREAM -->
                <div class="col-md-5" ng-init="ctrl.showAddUpstream = false">
                    <div ng-if="!ctrl.showAddUpstream">
                        <a class="clickable" ng-click="ctrl.showAddUpstream = true">
                            <waltz-icon name="plus"></waltz-icon>
                            Add Upstream Source
                        </a>
                    </div>
                    <div ng-if="ctrl.showAddUpstream " class="row">
                        <div class="col-md-8">
                            <waltz-app-selector model="ctrl.model.newSource"></waltz-app-selector>
                        </div>
                        <div class="col-md-4">
                            <button ng-click='ctrl.addSource(ctrl.model.newSource.app)'
                                    class="btn btn-sm btn-primary">
                                <waltz-icon name="plus"></waltz-icon>
                                Add
                            </button>
                            <a class="clickable" ng-click="ctrl.showAddUpstream = false">Cancel</a>
                        </div>
                    </div>
                </div>


                <div class="col-md-1">
                </div>

                <!-- ADD DOWNSTREAM -->
                <div class="col-md-5" ng-init="ctrl.showAddDownstream = false">
                    <div ng-if="!ctrl.showAddDownstream" class="pull-right">
                        <a class="clickable" ng-click="ctrl.showAddDownstream = true">
                            <waltz-icon name="plus"></waltz-icon>
                            Add Downstream Source
                        </a>
                    </div>
                    <div ng-if="ctrl.showAddDownstream" class="row">
                        <div class="col-md-8">
                            <waltz-app-selector model="ctrl.model.newTarget"></waltz-app-selector>
                        </div>
                        <div class="col-md-4">
                            <button ng-click='ctrl.addTarget(ctrl.model.newTarget.app)'
                                    class="btn btn-primary btn-sm">
                                <waltz-icon name="plus"></waltz-icon>
                                Add
                            </button>
                            <a class="clickable" ng-click="ctrl.showAddDownstream = false">Cancel</a>
                        </div>
                    </div>
                </div>
            </div>


            <!-- DATA TYPES SECTION -->
            <div class="row" ng-show="ctrl.model.selectedApp != null">
                <div class="col-md-11">

                    <!-- UPSTREAM / INCOMING -->
                    <h4 ng-if="ctrl.model.selectedDirection == 'target'">
                        Data flows to {{ ctrl.model.selectedApp.name }}
                        <small>( from {{ ctrl.app.name }} )</small>
                        <small>
                            <a class="pull-right" class="clickable" ng-click="ctrl.cancel()">
                                Close
                                <waltz-icon name="times-circle"></waltz-icon>
                            </a>
                        </small>
                    </h4>

                    <!-- DOWNSTREAM / OUTGOING -->
                    <h4 ng-if="ctrl.model.selectedDirection=='source'">
                        Data flows from {{ ctrl.model.selectedApp.name }}
                        <small>( to {{ ctrl.app.name }} )</small>
                        <small>
                            <a class="pull-right" class="clickable" ng-click="ctrl.cancel()">
                                Close
                                <waltz-icon name="times-circle"></waltz-icon>
                            </a>
                        </small>
                    </h4>

                    <!-- DATA TYPE OPTIONS -->
                    <ul class="list-unstyled">
                        <li ng-repeat="option in ctrl.model.selectedTypes | orderBy:'name'">
                            <span>
                                <input type="checkbox" ng-model="option.selected">
                                <span ng-style="{'font-weight': (option.selected ? 'bold' : 'none') }">{{ option.name }}</span>
                            </span>
                            <span class="text-muted small">{{option.description}}</span>
                        </li>
                    </ul>

                    <!-- ACTIONS -->
                    <button class="btn btn-success"
                            ng-click="ctrl.apply()">
                        Apply
                    </button>
                    <a href
                       ng-click="ctrl.cancel()">
                        Cancel
                    </a>

                </div>
            </div>
        </form>

    </waltz-section>

</div>


