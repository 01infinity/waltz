<div>
    <div class="row no-overflow"
         ng-if="ctrl.parent"
         style="padding: 1em">

        <div class="col-sm-12">
            <span class="text-muted">
                <waltz-icon name="level-up"></waltz-icon>
                Parent:
            </span>
            <a ui-sref="main.org-units.unit ({id: ctrl.parent.id })">
                {{ ctrl.parent.name }}
            </a>
            <span class="text-muted small ">
                {{ ctrl.parent.description }}
            </span>
        </div>

    </div>


    <div class="row"
         style="padding: 1em">

        <div class="col-sm-offset-1 col-sm-10 waltz-page-summary">
            <h3 style="margin-top: 10px; padding-bottom: 4px; border-bottom: 1px solid #eee;"> {{ ctrl.unit.name }} </h3>

            <div waltz-has-role="ORGUNIT_EDITOR">
                <waltz-inline-edit-area value="ctrl.unit.description"
                                        save="ctrl.saveDescriptionFn"></waltz-inline-edit-area>
            </div>
            <div waltz-unless-role="ORGUNIT_EDITOR">
                {{ ctrl.unit.description }}
            </div>

            <br>

            <div class="container-fluid">
                <div class="row">
                    <div class="col-sm-4">
                        <waltz-pie-table data="ctrl.pies.appPhase.data"
                                         config="ctrl.pies.appPhase.config"
                                         class="clickable"
                                         waltz-jump-to="ouv-apps"
                                         title="Apps By Lifecycle Phase"
                                         icon="desktop">
                        </waltz-pie-table>
                    </div>
                    <div class="col-sm-4">
                        <waltz-pie-table data="ctrl.pies.appInvestment.data"
                                         config="ctrl.pies.appInvestment.config"
                                         class="clickable"
                                         waltz-jump-to="ouv-apps"
                                         icon="money"
                                         title="Apps By Investment Status">
                        </waltz-pie-table>
                    </div>
                    <div class="col-sm-4">
                        <waltz-pie-table data="ctrl.pies.appConnections.data"
                                         config="ctrl.pies.appConnections.config"
                                         class="clickable"
                                         waltz-jump-to="ouv-flows"
                                         icon="random"
                                         title="Application Connections">
                        </waltz-pie-table>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-3">
                        <waltz-basic-info-tile name="Portfolio Cost"
                                               description="Cumulative value of infra and app dev costs"
                                               waltz-jump-to="ouv-costs"
                                               icon="money">
                            <span style="font-size: xx-large;">
                                {{ ctrl.portfolioCostStr }}
                            </span>
                        </waltz-basic-info-tile>
                    </div>
                    <div class="col-sm-3">
                        <waltz-basic-info-tile name="Complexity"
                                               description="Derived from capabilities, connections and servers"
                                               class="clickable"
                                               waltz-jump-to="ouv-complexity"
                                               icon="rocket">
                            <div style="font-size: xx-large;">
                                &Sigma; {{ ctrl.complexitySummary.cumulativeScore | toFixed:1 }}
                            </div>
                            <div class="small text-muted">
                                {{ ctrl.complexitySummary.averageScore | toFixed:2 }} per app
                            </div>
                        </waltz-basic-info-tile>

                    </div>
                    <div class="col-sm-3">
                        <waltz-basic-info-tile name="Servers"

                                               description="Number of servers supporting this org unit"
                                               waltz-jump-to="ouv-servers"
                                               icon="server">
                            <div>
                                <div style="font-size: xx-large;">
                                    # {{ ctrl.serverStats.total }}
                                </div>
                                <div class="small text-muted">
                                    {{ ctrl.serverStats.virtualPercentage }}% virtual
                                </div>
                            </div>
                        </waltz-basic-info-tile>

                    </div>

                    <div class="col-sm-3">
                        <waltz-basic-info-tile name="Capabilities"
                                               description="Capabilities performed within this OU"
                                               waltz-jump-to="ouv-ratings"
                                               icon="puzzle-piece">
                            <div>
                                <div style="font-size: xx-large;">
                                    # {{ ctrl.capabilityStats.total }}
                                </div>
                                <div class="small text-muted">
                                    {{ ctrl.capabilityStats.perApplication }} per app
                                </div>
                            </div>
                        </waltz-basic-info-tile>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <div class="row" ng-if="ctrl.children.length > 0">

        <div class="col-sm-offset-2 col-sm-10">
            <h4>Sub Units</h4>
            <table class="table table-hover table-condensed fixed-table">
                <tr ng-repeat="subUnit in ctrl.children | orderBy:'name'">
                    <td>
                        <a ui-sref="main.org-units.unit ({ id: subUnit.id })">
                            {{ ::subUnit.name }}
                        </a>
                    </td>
                    <td class="text-muted small no-overflow">
                        {{ ::subUnit.description }}
                    </td>
                </tr>
            </table>
            </waltz-section>
        </div>
    </div>
</div>
