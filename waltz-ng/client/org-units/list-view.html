<div>
    <waltz-page-header name="Organisational Units"
                       icon="sitemap">
        <ol class="waltz-breadcrumbs">
            <li><a ui-sref="main">Home</a></li>
            <li>Organisational Units</li>
        </ol>
    </waltz-page-header>

    <blockquote>
        The structure of the organisational hierarchy.
        An application is assigned to one of the organisational units and the unit inherits the characteristics of the
        assigned application. The organisational hierarchy allow applications statistics and capabilities to be
        aggregated up the tree.
    </blockquote>

    <!-- DIAGRAMS -->
    <waltz-section name="Organisational Unit"
                   small="Overview"
                   ng-if="ctrl.diagrams.length > 0">
        <waltz-svg-diagrams diagrams="ctrl.diagrams"
                            block-processor="ctrl.blockProcessor">
        </waltz-svg-diagrams>
    </waltz-section>


    <div class="row">
        <!-- STATIC PANELS -->
        <div class="col-md-12"
             ng-if="ctrl.panels.length > 0">
            <waltz-static-panels panels="ctrl.panels">
            </waltz-static-panels>
        </div>
    </div>


    <waltz-section name="Organisational Units">

        <!-- EXPORT -->
        <waltz-section-actions>
            <waltz-data-extract-link name="Download All"
                                     extract="org-units">
            </waltz-data-extract-link>

            &nbsp;

            <button class="btn btn-xs waltz-btn-transparent"
                    ng-click="ctrl.visibility.sourceDataRatings = ! ctrl.visibility.sourceDataRatings">
                <waltz-icon name="map-signs">
                </waltz-icon>
            </button>
        </waltz-section-actions>

        <waltz-source-data-overlay visible="ctrl.visibility.sourceDataRatings"
                                   ratings="ctrl.sourceDataRatings"
                                   entities="['ORG_UNIT']">
        </waltz-source-data-overlay>
        <!-- TREE -->
        <div class="row">
            <div class="col-sm-8">
                <waltz-org-unit-tree tree="ctrl.trees"
                                     on-selection="ctrl.nodeSelected">
                </waltz-org-unit-tree>
            </div>
            <div class="col-sm-4">
                <div ng-if="ctrl.selectedNode"
                     class="waltz-detail-callout">

                    <h3>
                        <span ng-bind="ctrl.selectedNode.name"></span>
                        <small class="pull-right clickable">
                            <waltz-icon name="times"
                                        ng-click="ctrl.selectedNode = null">
                            </waltz-icon>
                        </small>
                    </h3>

                    <h4 ng-if="ctrl.selectedNode.appCount > 0">
                        <span ng-bind="ctrl.selectedNode.appCount"></span>
                        Application/s
                    </h4>

                    <h5 ng-if="ctrl.selectedNode.childAppCount > 0">
                        <span ng-bind="ctrl.selectedNode.totalAppCount">
                        </span>
                        Applications (incl. sub-units)
                    </h5>

                    <hr>

                    <h4 ng-if="ctrl.selectedNode.endUserAppCount > 0">
                        <span ng-bind="ctrl.selectedNode.endUserAppCount"></span>
                        End User Application/s
                    </h4>

                    <h5 ng-if="ctrl.selectedNode.childEndUserAppCount > 0">
                        <span ng-bind="ctrl.selectedNode.totalEndUserAppCount">
                        </span>
                        End User Applications (incl. sub-units)
                    </h5>

                    <div class="small waltz-paragraph"
                         ng-bind="ctrl.selectedNode.description">
                    </div>

                    <a ui-sref="main.org-unit.view ({ id: ctrl.selectedNode.id })">
                        Show &raquo;
                    </a>

                    <br>
                </div>
            </div>
        </div>

        <hr>

        <!-- SEARCH -->
        <div class="row">
            <div class="col-md-6">
                <waltz-search clear="ctrl.clearSearch" search="ctrl.doSearch"></waltz-search>
            </div>
        </div>

        <br>

        <!-- SEARCH RESULTS -->
        <div class="row">
            <div class="col-md-12">
                <div ng-if="ctrl.filteredOrgUnits.length > 0">
                    <table class="table table-condensed table-striped small">
                        <colgroup>
                            <col width="30%">
                            <col width="70%">
                        </colgroup>
                        <tbody>
                        <tr ng-repeat="node in ctrl.filteredOrgUnits">
                            <td>
                                <a ui-sref="main.org-unit.view ({ id: node.id })"
                                   class="waltz-org-unit-name"
                                   ng-bind="node.name">
                                </a>
                            </td>
                            <td>
                                <span class="small"
                                      ng-bind="node.description">
                                </span>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </waltz-section>

</div>

