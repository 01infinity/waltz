<div>
    <waltz-page-header icon="check-square-o"
                       name="Attestations"
                       small="{{ctrl.user.userName}}">
        <ol class="waltz-breadcrumbs">
            <li><a ui-sref="main">Attestation</a></li>
            <li ng-bind="ctrl.user.userName"></li>
        </ol>
    </waltz-page-header>

    <div class="waltz-page-summary waltz-page-summary-attach">
        <h4>Pending</h4>
        <br>
        <div ng-if="ctrl.attestations.incomplete.length > 0">
            <table class="table table-striped table-condensed">
                <thead>
                <tr>
                    <th>Attestation</th>
                    <th>Description</th>
                    <th>Subject</th>
                    <th>Issued</th>
                    <th>Due</th>
                    <th>Target</th>
                    <th width="10%"></th>
                </tr>
                </thead>
                <tbody ng-repeat="incompleteAttestation in ctrl.attestations.incomplete" style="border-top: none">
                <tr>
                    <td ng-bind="incompleteAttestation.run.name">
                    </td>
                    <td ng-bind="incompleteAttestation.run.description">
                    </td>
                    <td>
                        <waltz-entity-link entity-ref="incompleteAttestation.instance.parentEntity">
                        </waltz-entity-link>
                    </td>
                    <td>
                        <waltz-from-now timestamp="incompleteAttestation.run.issuedOn">
                        </waltz-from-now>
                    </td>
                    <td>
                        <waltz-from-now timestamp="incompleteAttestation.run.dueDate">
                        </waltz-from-now>
                    </td>
                    <td>
                        <span ng-bind="incompleteAttestation.instance.childEntityKind | toDisplayName:'entity'">
                        </span>s
                    </td>
                    <td>
                        <a class="btn btn-primary btn-xs"
                           ng-click="ctrl.selectedAttestation = incompleteAttestation"
                           ng-if="ctrl.selectedAttestation !== incompleteAttestation">
                            Attest
                        </a>
                    </td>
                </tr>
                <tr ng-if="ctrl.selectedAttestation === incompleteAttestation">
                    <td colspan="7" style="padding-right: 3em">
                        <waltz-attestation-confirmation attestation="ctrl.selectedAttestation"
                                                        on-confirm="ctrl.attestEntity"
                                                        on-cancel="ctrl.cancelAttestation">
                        </waltz-attestation-confirmation>
                    </td>
                </tr>
                </tbody>

            </table>
        </div>

        <!-- No pending -->
        <div ng-if="ctrl.attestations.incomplete.length == 0">
            <span class="text-muted">
                No pending attestations
            </span>
        </div>

        <br>
        <br>

        <h4>Completed</h4>
        <br>
        <div ng-if="ctrl.attestations.complete.length > 0">
            <table class="table table-striped table-condensed">
                <thead>
                <tr>
                    <th>Attestation</th>
                    <th>Description</th>
                    <th>Subject</th>
                    <th>Target</th>
                    <th>Attested by</th>
                    <th>Attested at</th>
                </tr>
                </thead>
                <tbody>
                <tr ng-repeat="completeAttestation in ctrl.attestations.complete">
                    <td ng-bind="completeAttestation.run.name">
                    </td>
                    <td ng-bind="completeAttestation.run.description">
                    </td>
                    <td>
                        <waltz-entity-link entity-ref="completeAttestation.instance.parentEntity">
                        </waltz-entity-link>
                    </td>
                    <td>
                        <span ng-bind="completeAttestation.instance.childEntityKind | toDisplayName:'entity'">
                        </span>s
                    </td>
                    <td ng-bind="completeAttestation.instance.attestedBy">
                    </td>
                    <td>
                        <waltz-from-now timestamp="completeAttestation.instance.attestedAt">
                        </waltz-from-now>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
        <div ng-if="ctrl.attestations.complete.length == 0">
            <span class="text-muted">
                No completed attestations
            </span>
        </div>
    </div>


</div>