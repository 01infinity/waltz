<div>

    <!-- HEADER -->
    <waltz-page-header icon="user"
                       tour="ctrl.tour"
                       name="{{ ctrl.person.displayName }}">
        <ol class="waltz-breadcrumbs">
            <li><a ui-sref="main">Home</a></li>
            <li><a ui-sref="main.person">People</a></li>
            <li>{{ ctrl.person.displayName }}</li>
        </ol>
    </waltz-page-header>


    <!-- SUMMARY -->
    <waltz-person-summary person="ctrl.person"
                          asset-costs="ctrl.assetCostData.stats"
                          managers="ctrl.managers"
                          complexity="ctrl.complexity"
                          server-stats="ctrl.techStats.serverStats"
                          directs="ctrl.directs"
                          applications="ctrl.apps"
                          flows="ctrl.dataFlows.stats">
    </waltz-person-summary>

    <br>


    <waltz-section id='hierarchy-section'
                   name="Hierarchy">

        <div ng-if="ctrl.managers.length > 0">
            <h4>Managers</h4>
            <waltz-person-directs-list directs="ctrl.managers"></waltz-person-directs-list>
        </div>


        <div ng-if="ctrl.directs.length > 0">
            <h4>Directs</h4>
            <waltz-person-directs-list directs="ctrl.directs"></waltz-person-directs-list>
        </div>
    </waltz-section>


    <!-- CHANGE INITIATIVES -->
    <waltz-section name="Change Initiatives"
                   id="change-initiatives-section"
                   icon="paper-plane-o">

        <waltz-source-data-section-addon ratings="ctrl.sourceDataRatings"
                                         entities="['CHANGE_INITIATIVE', 'INVOLVEMENT']">
        </waltz-source-data-section-addon>

        <waltz-change-initiative-table ng-if='ctrl.changeInitiatives.length > 0'
                                       list="ctrl.changeInitiatives">
        </waltz-change-initiative-table>

        <div class="alert alert-warning" ng-if="ctrl.changeInitiatives.length == 0">
            <strong>This person is not associated with any Change Initiatives</strong>
        </div>

    </waltz-section>


    <!-- APPS -->
    <div ng-if="ctrl.hasInvolvements"
         id="apps-section">

        <waltz-section icon="desktop"
                       id="app-portfolio-section"
                       name="Application Portfolio">

            <waltz-source-data-section-addon ratings="ctrl.sourceDataRatings"
                                             entities="['APPLICATION', 'END_USER_APPLICATION', 'INVOLVEMENT']">
            </waltz-source-data-section-addon>

            <uib-tabset>

                <uib-tab heading="Summary">
                    <waltz-app-summary apps="ctrl.apps"
                                       end-user-apps="ctrl.endUserApps">
                    </waltz-app-summary>
                </uib-tab>


                <uib-tab select="showDirectTab = true"
                         heading="Direct"
                         ng-if="ctrl.combinedAppInvolvements.direct.length > 0">

                    <div ng-if="showDirectTab">
                        <h4> Direct Involvements </h4>
                        <waltz-app-table applications="ctrl.combinedAppInvolvements.direct">
                        </waltz-app-table>
                    </div>

                </uib-tab>


                <uib-tab select="showOversightTab=true"
                         heading="Oversight"
                         ng-if="ctrl.combinedAppInvolvements.indirect.length > 0">

                    <div ng-if="showOversightTab">
                        <h4> Oversight Involvements <small>(Inferred via direct reports)</small></h4>
                        <waltz-app-table applications="ctrl.combinedAppInvolvements.indirect">
                        </waltz-app-table>
                    </div>

                </uib-tab>

            </uib-tabset>

        </waltz-section>
    </div>


    <!-- COMPLEXITY -->
    <waltz-complexity-section complexity="ctrl.complexity"
                              ng-if="ctrl.hasInvolvements"
                              apps="ctrl.apps">
    </waltz-complexity-section>


    <!-- FLOWS -->
    <waltz-data-flows-tabgroup-section ratings="ctrl.sourceDataRatings"
                                       ng-if="ctrl.hasInvolvements"
                                       flow-data="ctrl.dataFlows"
                                       on-load-detail="ctrl.loadFlowDetail"
                                       applications="ctrl.apps">
    </waltz-data-flows-tabgroup-section>


    <!--LINEAGE REPORTS-->
    <waltz-section name="Lineage Reports"
                   id="lineage-reports-section">
        <waltz-section-actions>
            <button ng-click="ctrl.exportLineageReports()"
                    class="btn btn-xs btn-primary"
                    ng-if="ctrl.lineageReports.length > 0">
                Export
            </button>
        </waltz-section-actions>

        <waltz-physical-flow-table lineage="ctrl.lineageReports"
                                   on-initialise="ctrl.lineageTableInitialised"
                                   ng-if="ctrl.lineageReports.length > 0">
        </waltz-physical-flow-table>

        <div ng-if="ctrl.lineageReports.length == 0"
             class="alert alert-warning">
            <strong>No Lineage Reports</strong> have been defined
        </div>
    </waltz-section>


    <!-- AUTH SOURCES -->
    <waltz-section name="Authoritative Sources"
                   ng-if="ctrl.hasInvolvements"
                   id="authoritative-sources-section">
        <waltz-rated-flow-summary-panel ng-if='ctrl.entityRef'
                                        apps="ctrl.apps"
                                        entity-reference="ctrl.entityRef"
                                        flow-data="ctrl.dataFlows"
                                        on-load-detail="ctrl.loadFlowDetail">
        </waltz-rated-flow-summary-panel>

        <div ng-if="ctrl.dataFlows.stats.flowCounts.inbound == 0"
             class="alert alert-warning">
            No inbound data flows registered for this organisational unit
        </div>

        <div class="row" style="padding-top: 12px;">
            <div class="col-md-12">
                <div class="small text-muted">
                    This diagram summarises the data types sent to applications in this group.
                </div>
            </div>
        </div>
    </waltz-section>



    <!-- INDICATORS -->
    <waltz-entity-statistic-summary-section name="Indicators"
                                            ng-if="ctrl.hasInvolvements"
                                            definitions="ctrl.entityStatisticDefinitions"
                                            parent-ref="ctrl.entityRef">
    </waltz-entity-statistic-summary-section>


    <!-- TECHNOLOGIES -->
    <waltz-section name="Technologies"
                   ng-if="ctrl.hasInvolvements"
                   id="technologies-section">

        <waltz-source-data-section-addon ratings="ctrl.sourceDataRatings"
                                         entities="['SERVER', 'DATABASE', 'SOFTWARE']">
        </waltz-source-data-section-addon>

        <waltz-group-technology-summary stats="ctrl.techStats">
        </waltz-group-technology-summary>
    </waltz-section>


    <!-- COSTS -->
    <waltz-asset-costs-section data="ctrl.assetCostData"
                               ng-if="ctrl.hasInvolvements"
                               on-bucket-select="ctrl.onAssetBucketSelect"
                               source-data-ratings="ctrl.sourceDataRatings">
    </waltz-asset-costs-section>


</div>