<div>
    <!-- HEADER -->
    <waltz-page-header icon="user" name="{{ ctrl.person.displayName }}">
        <ol class="waltz-breadcrumbs">
            <li><a ui-sref="main">Home</a></li>
            <li><a ui-sref="main.person">People</a></li>
            <li>{{ ctrl.person.displayName }}</li>
        </ol>
    </waltz-page-header>


    <!-- SUMMARY -->
    <waltz-person-summary person="ctrl.person"
                          asset-costs="ctrl.assetCostData.stats"
                          managers="ctrl.managers"
                          complexity="ctrl.complexity"
                          server-stats="ctrl.techStats.serverStats"
                          directs="ctrl.directs"
                          applications="ctrl.apps"
                          flows="ctrl.dataFlows.stats">

    </waltz-person-summary>


    <!-- APPS -->
    <div ng-if="ctrl.hasInvolvements">

        <waltz-section icon="desktop"
                       name="Application Portfolio">

            <waltz-section-actions>
                <button class="btn btn-xs waltz-btn-transparent"
                        ng-click="ctrl.visibility.appOverlay = ! ctrl.visibility.appOverlay">
                    <waltz-icon name="map-signs"></waltz-icon>
                </button>
            </waltz-section-actions>

            <waltz-source-data-overlay visible="ctrl.visibility.appOverlay"
                                       ratings="ctrl.sourceDataRatings"
                                       entities="['APPLICATION']">
            </waltz-source-data-overlay>

            <uib-tabset>

                <uib-tab heading="Summary">
                    <div class="row">
                        <div class="col-sm-6">
                            <div>
                                <waltz-pie-table data="ctrl.charts.apps.byLifecyclePhase.data"
                                                 config="ctrl.charts.apps.byLifecyclePhase.config"
                                                 title="Applications By Lifecycle Phase">
                                </waltz-pie-table>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div>
                                <waltz-pie-table data="ctrl.charts.apps.byKind.data"
                                                 config="ctrl.charts.apps.byKind.config"
                                                 title="Applications By Type">
                                </waltz-pie-table>
                            </div>
                        </div>
                    </div>
                </uib-tab>


                <uib-tab select="showDirectTab = true"
                         heading="Direct"
                         ng-if="ctrl.involvements.direct.length > 0">

                    <div ng-if="showDirectTab"
                         ng-repeat="group in ctrl.involvements.direct | orderBy:'kind'">
                        <h4>
                            Role: {{group.kind | toDisplayName:'involvementKind'}}
                        </h4>

                        <waltz-app-table applications="group.apps">
                        </waltz-app-table>
                    </div>

                </uib-tab>


                <uib-tab select="showOversightTab=true"
                         heading="Oversight"
                         ng-if="ctrl.involvements.indirect.length > 0">

                    <div ng-if="showOversightTab">
                        <h4> Oversight Involvements <small>(Inferred via direct reports)</small></h4>
                        <waltz-app-table applications="ctrl.involvements.indirect">
                        </waltz-app-table>
                    </div>

                </uib-tab>

            </uib-tabset>

        </waltz-section>


        <!-- COMPLEXITY -->
        <waltz-complexity-section complexity="ctrl.complexity"
                                  apps="ctrl.apps">
        </waltz-complexity-section>


        <!-- FLOWS -->
        <waltz-section name="Logical Data Flows"
                       icon="random">

            <waltz-section-actions>
                <button class="btn btn-xs waltz-btn-transparent"
                        ng-click="ctrl.visibility.flowOverlay = ! ctrl.visibility.flowOverlay">
                    <waltz-icon name="map-signs"></waltz-icon>
                </button>
            </waltz-section-actions>

            <waltz-source-data-overlay visible="ctrl.visibility.flowOverlay"
                                       ratings="ctrl.sourceDataRatings"
                                       entities="['LOGICAL_DATA_FLOW']">
            </waltz-source-data-overlay>

            <waltz-data-flows-tabgroup flow-data="ctrl.dataFlows"
                                       on-load-detail="ctrl.loadFlowDetail"
                                       options="ctrl.flowOptions">
            </waltz-data-flows-tabgroup>
        </waltz-section>


        <!-- TECHNOLOGIES -->
        <waltz-section name="Technologies">

            <waltz-section-actions>
                <button class="btn btn-xs waltz-btn-transparent"
                        ng-click="ctrl.visibility.techOverlay = ! ctrl.visibility.techOverlay">
                    <waltz-icon name="map-signs"></waltz-icon>
                </button>
            </waltz-section-actions>

            <waltz-source-data-overlay visible="ctrl.visibility.techOverlay"
                                       ratings="ctrl.sourceDataRatings"
                                       entities="['SERVER', 'DATABASE', 'SOFTWARE']">
            </waltz-source-data-overlay>

            <waltz-group-technology-summary stats="ctrl.techStats">
            </waltz-group-technology-summary>
        </waltz-section>


        <!-- COSTS -->
        <waltz-asset-costs-section data="ctrl.assetCostData"
                                   on-bucket-select="ctrl.onAssetBucketSelect"
                                   source-data-ratings="ctrl.sourceDataRatings">
        </waltz-asset-costs-section>


    </div>

</div>
