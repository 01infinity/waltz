<!--
  ~  Waltz
  ~ Copyright (c) David Watkins. All rights reserved.
  ~ The use and distribution terms for this software are covered by the
  ~ Eclipse Public License 1.0 (http://opensource.org/licenses/eclipse-1.0.php)
  ~ which can be found in the file epl-v10.html at the root of this distribution.
  ~ By using this software in any fashion, you are agreeing to be bound by
  ~ the terms of this license.
  ~ You must not remove this notice, or any other, from this software.
  ~
  -->

<div>
    <waltz-page-header name="Capabilities"
                       icon="puzzle-piece">
        <ol class="waltz-breadcrumbs">
            <li><a ui-sref="main">Home</a></li>
            <li>Capabilities</li>
        </ol>
    </waltz-page-header>

    <blockquote>
        Capabilities as defined by the business to support their products and services.
        Capabilities are assigned to an applications and organisation through association.
        Capabilities matrices can be useful in identifying hotspots of functionality within an organisation and the potential for application consolidation.
    </blockquote>


    <!-- DIAGRAMS -->
    <waltz-section name="Capabilities" small="Overview" ng-if="ctrl.diagrams.length > 0">
        <waltz-svg-diagrams diagrams="ctrl.diagrams" block-processor="ctrl.blockProcessor">
        </waltz-svg-diagrams>
    </waltz-section>


    <!-- STATIC PANELS -->
    <div class="row"
         ng-if="ctrl.panels.length > 0">
        <div class="col-sm-12">
            <waltz-static-panels panels="ctrl.panels">
            </waltz-static-panels>
        </div>
    </div>


    <!-- TREE -->
    <waltz-section name="Capabilities" small="All">


        <ul class="list-unstyled"
            ng-show="ctrl.capabilityHierarchy.length > 0">
            <li ng-repeat="capability in ctrl.capabilityHierarchy | orderBy:'name'">
                <div ng-include="'inline/capabilities/tree/node.html'"
                     ng-init="node=capability; level=1"></div>
            </li>
        </ul>

        <div class="alert alert-warning"
             ng-show="ctrl.capabilityHierarchy.length == 0">
            <strong>No Capabilities</strong> have been defined within this system.
        </div>

        <hr/>

        <div class="alert alert-info">
            <waltz-data-extract-link name="Download All"
                                     extract="capabilities"></waltz-data-extract-link>
        </div>
    </waltz-section>


    <script type="text/ng-template"
            id="inline/capabilities/tree/node.html">
        <div class="waltz-org-unit-level waltz-org-unit-level-{{ level }}">
            <a ui-sref="main.capability.view ({ id: node.id })"
               class="waltz-org-unit-name">
                {{ node.name }}
            </a>
            <span ng-if="ctrl.tallies[node.id] > 0"
                  class="small waltz-tally-count"
                  title="Number of applications">
                {{ ctrl.tallies[node.id] }} application/s
            </span>
            <div class="text-muted no-overflow">
                {{ node.description }}
            </div>
        </div>

        <ul class="list-unstyled">
            <li ng-repeat="node in node.children | orderBy:'name'"
                ng-init="level=level+1"
                ng-include="'inline/capabilities/tree/node.html'"></li>
        </ul>
    </script>
</div>
