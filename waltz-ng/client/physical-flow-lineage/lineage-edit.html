<div>
    <!-- HEADER -->
    <waltz-page-header name="{{ ctrl.describedSpecification.name }}"
                       small="Lineage Editor"
                       icon="qrcode">
        <ol class="waltz-breadcrumbs">
            <li><a ui-sref="main">Home</a></li>
            <li>
                <a ui-sref="main.app.view ({ id: ctrl.owningApplication.id })">
                    <span ng-bind="ctrl.owningApplication.name"></span>
                </a>
            </li>
            <li>
                <a ui-sref="main.physical-specification.view ({ id: ctrl.describedSpecification.id })">
                    <span ng-bind="ctrl.describedSpecification.name"></span>
                </a>
            </li>
            <li>Lineage</li>
            <li>
                <a ui-sref="main.lineage-report.view ({ id: ctrl.lineageReport.id })"
                   ng-bind="ctrl.lineageReport.name">
                </a>
            </li>
            <li>Edit</li>
        </ol>
    </waltz-page-header>


    <div class="waltz-page-summary waltz-page-summary-attach">
        <h4>
                Physical flow of
                <mark ng-bind="ctrl.describedSpecification.name"></mark>
                from
                <mark ng-bind="ctrl.describedSpecification.owningEntity.name"></mark>
                to
                <mark ng-bind="ctrl.describedFlow.target.name"></mark>
        </h4>
        <hr>
        <div class="row">
            <div class="col-sm-3">
                <label>Specification Details:</label>
            </div>
            <div class="col-sm-9">
                <waltz-physical-specification-overview owning-entity="ctrl.owningApplication"
                                                       specification="ctrl.describedSpecification"
                                                       organisational-unit="ctrl.owningOrgUnit">
                </waltz-physical-specification-overview>
            </div>
        </div>

    </div>

    <br>

    <waltz-section name="Edit">
        <div class="row">
            <div class="col-sm-12">
                <h4>Contributors</h4>
                <table class="table table-condensed table-striped table-hover small">
                    <thead>
                    <tr>
                        <th>Specification</th>
                        <th>Source</th>
                        <th>Target</th>
                        <th>Format</th>
                        <th>Transport</th>
                        <th>Frequency</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="c in ctrl.lineage" class="waltz-visibility-parent">
                        <td>
                            <span uib-popover="{{ c.specification.description }}"
                                  popover-trigger="mouseenter"
                                  ng-bind="c.specification.name"></span>
                        </td>
                        <td>
                            <a ng-click="ctrl.doSearch(c.sourceApplication)"
                               uib-popover="Focus on app"
                               popover-trigger="mouseenter"
                               ng-bind="c.sourceApplication.name"></a>
                        </td>
                        <td>
                            <a ng-click="ctrl.doSearch(c.targetApplication)"
                               uib-popover="Focus on app"
                               popover-trigger="mouseenter"
                               ng-bind="c.targetApplication.name"></a>
                        </td>
                        <td>
                            <span ng-bind="c.specification.format"></span>
                        </td>
                        <td>
                            <span ng-bind="c.flow.transport"></span>
                        </td>
                        <td>
                            <span ng-bind="c.flow.frequency"></span>
                        </td>
                        <td>
                            <span class="waltz-visibility-child-30">
                                <button class="btn btn-xs btn-danger"
                                        ng-click="ctrl.removePhysicalFlow(c.flow)">
                                    Remove
                                </button>
                            </span>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <hr>

        <div class="row">
            <div class="col-sm-9">
                <h4 ng-bind="ctrl.searchResults.app.name"></h4>

                <waltz-lineage-candidate-editor logical-flows="ctrl.searchResults.logicalFlows"
                                                physical-flows="ctrl.searchResults.physicalFlows"
                                                specifications="ctrl.searchResults.specifications"
                                                on-add="ctrl.addPhysicalFlow"
                                                on-refocus="ctrl.doSearch">
                </waltz-lineage-candidate-editor>

            </div>
            <div class="col-sm-3">
                <p class="small text-muted">
                    Use this area to search for flows by first finding their associated applications.
                </p>
                <waltz-app-selector model="ctrl.selectedApp"></waltz-app-selector>
                <hr>
                <div ng-if="ctrl.searchResults.relatedApps.length > 0">
                    <h5>Related Apps</h5>
                    <div ng-class="{'waltz-scroll-region-250' : ctrl.searchResults.relatedApps.length > 12 }">
                        <ul class="list-unstyled small">
                            <li ng-repeat="app in ctrl.searchResults.relatedApps | orderBy:'name'">
                                <a class="clickable"
                                   ng-bind="app.name"
                                   ng-click="ctrl.doSearch(app)"></a>
                            </li>
                        </ul>
                    </div>

                </div>

            </div>
        </div>


    </waltz-section>

    <waltz-section name="dump" ng-hide="true">
        <div class="row">
            <div class="col-sm-3">
                <h4>Search Results</h4>
                <pre ng-bind="ctrl.searchResults | json"></pre>
            </div>
            <div class="col-sm-3">
                <h4>Lineage</h4>
                <pre ng-bind="ctrl.lineage|json"></pre>
            </div>
            <div class="col-sm-3">
                <h4>Described</h4>
                <pre ng-bind="ctrl.describedFlow|json"></pre>
                <pre ng-bind="ctrl.describedSpecification|json"></pre>
            </div>
            <div class="col-sm-3">
                <h4></h4>
                <pre ng-bind="ctrl.xxx"></pre>
            </div>
        </div>
    </waltz-section>
</div>