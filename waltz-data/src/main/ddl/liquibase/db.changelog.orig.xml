<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!--
  ~  This file is part of Waltz.
  ~
  ~     Waltz is free software: you can redistribute it and/or modify
  ~     it under the terms of the GNU General Public License as published by
  ~     the Free Software Foundation, either version 3 of the License, or
  ~     (at your option) any later version.
  ~
  ~     Waltz is distributed in the hope that it will be useful,
  ~     but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~     GNU General Public License for more details.
  ~
  ~     You should have received a copy of the GNU General Public License
  ~     along with Waltz.  If not, see <http://www.gnu.org/licenses/>.
  -->

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">
    <changeSet author="dwatkins (generated)" id="1448813483502-1">
        <createSequence sequenceName="access_log_id_seq"/>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-2">
        <createSequence sequenceName="application_id_seq"/>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-3">
        <createSequence sequenceName="authoritative_source_id_seq"/>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-4">
        <createSequence sequenceName="bookmark_id_seq"/>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-5">
        <createSequence sequenceName="change_log_id_seq"/>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-6">
        <createSequence sequenceName="change_log_id_seq1"/>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-7">
        <createSequence sequenceName="person_id_seq"/>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-8">
        <createSequence sequenceName="perspective_id_seq"/>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-9">
        <createSequence sequenceName="perspective_measure_id_seq"/>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-10">
        <createSequence sequenceName="server_information_id_seq"/>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-11">
        <createSequence sequenceName="software_directory_id_seq"/>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-12"> <!-- done -->
        <createTable tableName="access_log">
            <column autoIncrement="true" name="id" type="SERIAL">
                <constraints primaryKey="true" primaryKeyName="access_log_pkey"/>
            </column>
            <column name="user_id" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
            <column name="state" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="params" type="VARCHAR(1024)"/>
            <column defaultValueComputed="now()" name="created_at" type="TIMESTAMP(6) WITHOUT TIME ZONE"/>
        </createTable>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-13">
        <createTable tableName="app_capability">
            <column name="application_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="capability_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column defaultValueBoolean="false" name="is_primary" type="BOOL">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-14">
        <createTable tableName="application">
            <column autoIncrement="true" name="id" type="BIGSERIAL">
                <constraints primaryKey="true" primaryKeyName="application_pkey"/>
            </column>
            <column name="name" type="VARCHAR(255)"/>
            <column name="description" type="CHARACTER VARYING"/>
            <column name="aliases" type="_VARCHAR(2147483647)"/>
            <column name="asset_code" type="VARCHAR(255)"/>
            <column defaultValueComputed="now()" name="created_at" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column defaultValueComputed="now()" name="updated_at" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="organisational_unit_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="IN_HOUSE" name="kind" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="PRODUCTION" name="lifecycle_phase" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
            <column name="parent_asset_code" type="VARCHAR(255)"/>
            <column name="tags" type="_VARCHAR(2147483647)"/>
        </createTable>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-15">
        <createTable tableName="authoritative_source">
            <column autoIncrement="true" name="id" type="BIGSERIAL">
                <constraints primaryKey="true" primaryKeyName="authoritative_source_pkey"/>
            </column>
            <column name="parent_kind" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
            <column name="data_type" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
            <column name="parent_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="application_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="rating" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-16">
        <createTable tableName="bookmark">
            <column autoIncrement="true" name="id" type="BIGSERIAL">
                <constraints primaryKey="true" primaryKeyName="bookmark_pkey"/>
            </column>
            <column name="title" type="VARCHAR(255)"/>
            <column name="description" type="VARCHAR(255)"/>
            <column name="kind" type="VARCHAR(255)"/>
            <column name="url" type="VARCHAR(255)"/>
            <column name="parent_kind" type="VARCHAR(255)"/>
            <column name="parent_id" type="BIGINT"/>
            <column name="created_at" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="updated_at" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column defaultValueBoolean="false" name="is_primary" type="BOOL">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-17">
        <createTable tableName="capability">
            <column name="id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="parent_id" type="BIGINT"/>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="CHARACTER VARYING">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-18">
        <createTable tableName="change_log">
            <column autoIncrement="true" name="id" type="SERIAL">
                <constraints primaryKey="true" primaryKeyName="change_log_pkey"/>
            </column>
            <column name="parent_kind" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
            <column name="parent_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="message" type="CHARACTER VARYING">
                <constraints nullable="false"/>
            </column>
            <column name="user_id" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
            <column name="severity" type="VARCHAR(32)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueComputed="now()" name="created_at" type="TIMESTAMP(6) WITHOUT TIME ZONE">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-19">
        <createTable tableName="data_flow">
            <column name="source_entity_kind" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
            <column name="source_entity_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="target_entity_kind" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
            <column name="target_entity_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="data_type" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-20">
        <createTable tableName="data_type">
            <column name="code" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(256)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="CHARACTER VARYING">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-21">
        <createTable tableName="involvement">
            <column name="entity_kind" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
            <column name="entity_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="kind" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
            <column name="employee_id" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-22">
        <createTable tableName="organisational_unit">
            <column name="id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)"/>
            <column name="description" type="CHARACTER VARYING"/>
            <column name="kind" type="VARCHAR(255)"/>
            <column name="parent_id" type="BIGINT"/>
            <column defaultValueComputed="now()" name="created_at" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column defaultValueComputed="now()" name="updated_at" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-23">
        <createTable tableName="person">
            <column autoIncrement="true" name="id" type="BIGSERIAL">
                <constraints primaryKey="true" primaryKeyName="person_pkey"/>
            </column>
            <column name="employee_id" type="VARCHAR(128)"/>
            <column name="display_name" type="VARCHAR(255)"/>
            <column name="email" type="VARCHAR(255)"/>
            <column name="user_principal_name" type="VARCHAR(255)"/>
            <column name="department_name" type="VARCHAR(255)"/>
            <column name="kind" type="VARCHAR(255)"/>
            <column name="manager_employee_id" type="VARCHAR(128)"/>
            <column name="title" type="VARCHAR(255)"/>
            <column name="office_phone" type="VARCHAR(128)"/>
            <column name="mobile_phone" type="VARCHAR(128)"/>
        </createTable>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-24">
        <createTable tableName="person_hierarchy">
            <column name="manager_id" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
            <column name="employee_id" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="99" name="level" type="INT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-25">
        <createTable tableName="perspective">
            <column defaultValue="BUSINESS" name="code" type="VARCHAR(32)">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="TEXT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-26">
        <createTable tableName="perspective_measurable">
            <column defaultValue="" name="code" type="VARCHAR(32)">
                <constraints nullable="false"/>
            </column>
            <column name="perspective_code" type="VARCHAR(32)">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="TEXT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-27">
        <createTable tableName="perspective_rating">
            <column name="measure_code" type="VARCHAR(32)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="Z" name="rating" type="CHAR(1)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="APPLICATION" name="parent_kind" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
            <column name="parent_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="capability_id" type="BIGINT"/>
            <column defaultValue="BUSINESS" name="perspective_code" type="VARCHAR(32)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-28">
        <createTable tableName="schema_version">
            <column name="version_rank" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="installed_rank" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="version" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(200)">
                <constraints nullable="false"/>
            </column>
            <column name="type" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="script" type="VARCHAR(1000)">
                <constraints nullable="false"/>
            </column>
            <column name="checksum" type="INT"/>
            <column name="installed_by" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueComputed="now()" name="installed_on" type="TIMESTAMP(6) WITHOUT TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="execution_time" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="success" type="BOOL">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-29">
        <createTable tableName="server_information">
            <column autoIncrement="true" name="id" type="SERIAL">
                <constraints primaryKey="true" primaryKeyName="server_information_pkey"/>
            </column>
            <column name="hostname" type="VARCHAR(256)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="UNKNOWN" name="operating_system" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="DEV" name="environment" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
            <column name="location" type="VARCHAR(128)"/>
            <column name="asset_code" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-30">
        <createTable tableName="software_directory">
            <column autoIncrement="true" name="id" type="SERIAL">
                <constraints primaryKey="true" primaryKeyName="software_directory_pkey"/>
            </column>
            <column name="vendor" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="version" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="HOLD" name="adoption_status" type="VARCHAR(64)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueBoolean="false" name="notable" type="BOOL"/>
            <column name="description" type="TEXT"/>
        </createTable>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-31">
        <createTable tableName="user">
            <column name="user_name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="password" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-32">
        <createTable tableName="user_role">
            <column name="user_name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="role" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-33">
        <addPrimaryKey columnNames="application_id, capability_id" constraintName="app_capability_pkey" tableName="app_capability"/>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-34">
        <addPrimaryKey columnNames="id" constraintName="capability_pkey" tableName="capability"/>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-35">
        <addPrimaryKey columnNames="source_entity_kind, source_entity_id, target_entity_id, target_entity_kind, data_type" constraintName="data_flow_pkey" tableName="data_flow"/>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-36">
        <addPrimaryKey columnNames="code" constraintName="data_type_pkey" tableName="data_type"/>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-37">
        <addPrimaryKey columnNames="id" constraintName="organisational_unit_pkey" tableName="organisational_unit"/>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-38">
        <addPrimaryKey columnNames="code" constraintName="perspective_measure_pkey" tableName="perspective_measurable"/>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-39">
        <addPrimaryKey columnNames="code" constraintName="perspective_pkey" tableName="perspective"/>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-40">
        <addPrimaryKey columnNames="manager_id, employee_id" constraintName="reportee_pkey" tableName="person_hierarchy"/>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-41">
        <addPrimaryKey columnNames="version" constraintName="schema_version_pk" tableName="schema_version"/>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-42">
        <addPrimaryKey columnNames="user_name" constraintName="user_pkey" tableName="user"/>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-43">
        <addUniqueConstraint columnNames="code" constraintName="unique_code" tableName="perspective"/>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-44">
        <addUniqueConstraint columnNames="employee_id" constraintName="unique_employee_id" tableName="person"/>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-45">
        <createIndex indexName="fki_authoritative_source_application_id_fkey" tableName="authoritative_source">
            <column name="application_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-46">
        <createIndex indexName="schema_version_ir_idx" tableName="schema_version">
            <column name="installed_rank"/>
        </createIndex>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-47">
        <createIndex indexName="schema_version_s_idx" tableName="schema_version">
            <column name="success"/>
        </createIndex>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-48">
        <createIndex indexName="schema_version_vr_idx" tableName="schema_version">
            <column name="version_rank"/>
        </createIndex>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-49">
        <createIndex indexName="unique_name" tableName="application" unique="true">
            <column name="name"/>
        </createIndex>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-50">
        <addForeignKeyConstraint baseColumnNames="organisational_unit_id" baseTableName="application" constraintName="application_organisational_unit_id_fkey" deferrable="false" initiallyDeferred="false" onDelete="SET NULL" onUpdate="CASCADE" referencedColumnNames="id" referencedTableName="organisational_unit"/>
    </changeSet>
    <changeSet author="dwatkins (generated)" id="1448813483502-51">
        <addForeignKeyConstraint baseColumnNames="application_id" baseTableName="authoritative_source" constraintName="authoritative_source_application_id_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="application"/>
    </changeSet>
</databaseChangeLog>
